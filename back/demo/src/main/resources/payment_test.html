<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8">
</head>
<body>
<!-- 제이쿼리 -->
<script type="text/javascript" src="https://code.jquery.com/jquery-1.12.4.min.js"></script><!-- 아임포트 -->
<script src ="https://cdn.iamport.kr/js/iamport.payment-1.2.0.js" type="text/javascript"></script>
<div>
    <h2>아임포트 결제 데모</h2>
    <li>
        <button id="iamportPayment" type="button">결제테스트</button>
    </li>
</div>

<script>
$(document).ready(function(){
    $("#iamportPayment").click(function (){
        payment(1);
    });
})

function payment(data){
    IMP.init('imp42602260');
    IMP.request_pay({
        pg:"kakaopay.TC0ONETIME",
        pay_method:"card",
        merchant_uid:"iamport_test_id5",
        name:"도서",
        amount:data,
        buyer_email:"rl00822@naver.com",
        buyer_name:"이기종",
        buyer_tel:"01087624001"

    }, function (rsp){
        if(rsp.success){
            var form = document.createElement('form');
            form.setAttribute('method', 'put');
            form.setAttribute('target', '_blank');
            form.setAttribute('action', 'http://localhost:8080/users/points');
            document.charset = "UTF-8";

            var hiddenField = document.createElement('input');
            hiddenField.setAttribute('type', 'hidden');
            hiddenField.setAttribute('name', 'id');
            hiddenField.setAttribute('value', 100);
            form.appendChild(hiddenField);

            form.appendChild(hiddenField);

            document.body.appendChild(form);
            form.submit();
            alert("완료 -> imp_uid : " + rsp.imp_uid+" / merchant_uid(orderKey) : " + rsp.merchant_uid);
        }else{
            alert("실패 : 코드(" + rsp.error_code + ") / 메시지(" + rsp.error_msg + ")");
        }
    });
}
</script>

</body>
</html>